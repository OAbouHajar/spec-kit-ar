---
description: إنشاء أو تحديث مواصفة الميزة (Specification) انطلاقاً من وصف نصي طبيعي للميزة.
scripts:
  sh: scripts/bash/create-new-feature.sh --json "{ARGS}"
  ps: scripts/powershell/create-new-feature.ps1 -Json "{ARGS}"
---

مدخلات المستخدم (المقطع الذي كُتب بعد `/specify` أو `/تحديد`) **هو** الوصف الخام للميزة. اعتبر أنه متاح في المحادثة حتى إن ظهر `{ARGS}` حرفياً هنا. لا تطلب من المستخدم تكراره إلا إذا كان المدخل فارغاً تماماً.

مدخلات المستخدم:

$ARGUMENTS

الهدف: توليد ملف مواصفة منظم `مواصفة.md` يغطي النطاق، المتطلبات، قصص المستخدم، القيود، والحالات الحدّية، مستنداً إلى وصف الميزة الخام + أي سياق حالي في المستودع، مع الحفاظ على الهيكل القياسي للقالب.

## 1. تنفيذ السكربت الأوّلي (Branch & File Bootstrap)

1. شغّل `{SCRIPT}` (مرة واحدة فقط) من جذر المستودع.
2. حلّل JSON الناتج لاستخراج:
   - `BRANCH_NAME`
   - `SPEC_FILE` (المسار المطلق لملف مواصفة.md المُنشأ)
3. ممنوع إعادة تشغيل السكربت لتفادي إعادة إنشاء الفرع أو الكتابة العشوائية.

## 2. تحميل القالب

اقرأ `templates/spec-template.md` لمعرفة:
- ترتيب الأقسام الإلزامي.
- العناوين المعتمدة (لا تغيّر مستويات Markdown).
- أي ملاحظات Placeholder متوقعة.

## 3. اشتقاق العناصر من الوصف

من الوصف النصي (والسياق إن وجد في README / docs):
استخرج / اشتق:
| مكوّن | ناتج |
|-------|------|
| الهدف الرئيسي | بيان موجز (Problem / Value) |
| أصحاب المصلحة / الأدوار | قائمة (Persona / Role) |
| قصص المستخدم | صيغة: كـ[دور] أريد [هدف] حتى [قيمة] |
| المتطلبات الوظيفية | قائمة مرقمة واضحة أمرية (يُمكن، يجب...) |
| المتطلبات غير الوظيفية | أداء، أمن، قابلية توسع، مراقبة، تجربة استخدام، إلخ |
| قيود / مفاضلات | أطر، لغات، استثناءات، حدود تقنية |
| مخاطر / أسئلة مفتوحة | إن وُجدت |
| الحالات الحدّية | أخطاء، أحجام قصوى، حالات فارغة، تعارضات |
| تعريف الاكتمال | معايير قبول عليا قابلة للاختبار |

قواعد:
- كل متطلب وظيفي بصياغة قابلة للاختبار (تجنّب الغموض).
- المتطلبات غير الوظيفية تتضمّن مقاييس (إن أمكن) أو TODO(قياس) مع سبب.
- دمج التكرارات (لا تكرار منطقي).
- المصطلحات المتعددة لنفس المفهوم → اختر واحدة وأضف (سابقاً: "X") مرة واحدة عند أول ظهور.

## 4. بناء ملف المواصفة

اكتب في `SPEC_FILE` وفق القالب:
- لا تحذف أقساماً أساسية حتى لو فارغة: ضع TODO مبرر (مثال: `TODO(Data Model): يُستكمل في التخطيط`).
- أضف قسم `## Clarifications` فارغ مهيأ لدورات `/توضيح`.
- لا تُدخل المهام هنا (ستُشتق لاحقاً في `/تخطيط` و`/مهام`).
- استخدم عناوين عربية ثابتة (إن كان القالب إنجليزي حافظ التنسيق لكن أضف ترجمة بين قوسين عند الحاجة حتى الانتقال الكامل).

مثال (مُبسّط):
```
## Functional Requirements
1. المستخدم يمكنه ...
2. النظام يسجّل ...

## Non-Functional (الأداء / الأمن / المراقبة)
- أداء: TODO(Define latency target)
```

## 5. ضمان الاتساق

تحقق داخلياً قبل الحفظ:
- لا توجد Placeholder بقيت غير مفسرة بلا TODO.
- لا توجد جُمَل عامة مبهمة بلا معيار (استبدل أو ضع TODO توضيحي).
- كل قصة مستخدم تقود لمتطلبات (إن وُجد قصص بلا متطلبات أضف ملاحظة).
- عدم تضارب المصطلحات.

## 6. الحفظ

اكتب الملف Atomically (استبدال كامل المحتوى).  
لا تُنشئ ملفات أخرى في هذه الخطوة.  
لا تُعدل الفرع خارج ما أنشأه السكربت.

## 7. مخرجات الإنهاء (خارجياً)

أخرج موجزاً (لا يُكتب داخل الملف):
- Branch: `BRANCH_NAME`
- Spec Path: `SPEC_FILE`
- عدد المتطلبات الوظيفية / غير الوظيفية
- TODOs المفتوحة (عدد + قائمة مختصرة)
- توصية الأمر التالي: عادةً `/توضيح` لتحسين الغموض أو `/تخطيط` إذا كان الوضوح كافياً.

## 8. قواعد السلوك

- ممنوع اختراع تفاصيل تجعَل الخطة مُقيّدة دون مبرر.
- لا تُحوّل الوصف إلى تصميم عمارة (يتم في `/تخطيط`).
- لا تُولّد مهام تنفيذية هنا.
- حافظ على إمكانية إعادة التشغيل: نفس الوصف → نفس المواصفة (عدا الطوابع الزمنية إن وجدت).

## 9. فشل الحالات

| الحالة | التصرف |
|--------|--------|
| وصف فارغ | اطلب من المستخدم إعادة المحاولة بوصف كافٍ |
| سكربت فشل | أعد عرض الخطأ الخام واقترح التحقق من git أو البنية |
| ملف موجود ويحوي محتوى غير فارغ | دمج محسوب (Append Clarifications Stub فقط إن مفقود) أو اذكر أنه محدث |

ملاحظة توافق: يمكن استدعاء الأمر باسم `/specify` بينما اسم الملف عربي `تحديد.md`. دعم `/تحديد` ممكن لاحقاً.

السياق Context: {ARGS}
