---
description: توليد ملف مهام تنفيذي (مهام.md) مرتب بالاعتمادات وقابل للتنفيذ استناداً إلى المخرجات التصميمية المتاحة.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

مدخلات المستخدم (Arguments) — تُستخدم كـ سياق إضافي عند توليد المهام (إن وُجدت).

مدخلات المستخدم:

$ARGUMENTS

الهدف: إنشاء `مهام.md` منظم، مرقّم، محدد بما يكفي ليُنفَّذ آلياً/نصف‑آلي، يعتمد على الوثائق المتوفرة ويُحافظ على تتابع منطقي + تمييز المهام المتوازية `[P]` بدون تعارض ملفات.

## 1. جمع السياق

1. شغّل `{SCRIPT}` من جذر المستودع. حلّل JSON لاستخراج:
   - `FEATURE_DIR`
   - `AVAILABLE_DOCS`
2. اشتق المسارات المطلقة المتوقعة (قد تختلف حسب ما هو موجود):
   - تخطيط.md
   - نموذج-البيانات.md (اختياري)
   - العقود/ (اختياري)
   - بحث.md (اختياري)
   - بدء-سريع.md (اختياري)
3. المسار الهدف للنتيجة: `FEATURE_DIR/مهام.md`.

## 2. تحميل وتحليل الوثائق (شرطي حسب الوجود)

| ملف | الغرض |
|-----|-------|
| تخطيط.md | المكدس التقني، المعمارية، المراحل |
| نموذج-البيانات.md | الكيانات + العلاقات → مهام النماذج |
| العقود/ | تعريف واجهات/Endpoints → مهام الاختبار والتنفيذ |
| بحث.md | القرارات / المخاطر → مهام تقليل المخاطر |
| بدء-سريع.md | سيناريوهات تشغيل → مهام توثيق/اختبار تكامل |

## 3. تصنيف مصادر المهام

مصادر توليد المهام:
- الكيانات → مهام إنشاء نموذج / طبقة وصول.
- العقود (ملفات/Endpoints) → مهام اختبار عقد + تنفيذ نقطة واجهة.
- قرارات معمارية (في تخطيط.md) → مهام إعداد بنية/تهيئة.
- مخاطر (بحث.md) → مهام تخفيف (Mitigation).
- سيناريوهات استخدام / رحلات أساسية → مهام اختبار تكاملي.
- المتطلبات غير الوظيفية (Performance / Logging / Security) → مهام تحسين/ضبط/مراقبة.

## 4. تصنيف المراحل (افتراضي – يعدَّل حسب التخطيط)

مراحل قياسية:
1. Setup
2. Models
3. Services / Core
4. Contracts / API
5. Integration
6. Tests (قد تُوزَّع أو تُسبق حسب TDD)
7. Observability / Performance / Security
8. Polish / Docs

(عدِّل الترتيب/المراحل إن فرض التخطيط بنية مختلفة — احتفظ باتساق الترتيب.)

## 5. قواعد الترقيم والصيغة

- معرف المهمة: `T001`, `T002`, ...
- صيغة العنوان: أمر صريح بصيغة فعل أولي (مثال: "إنشاء نموذج المستخدم").
- وسم المهام القابلة للتوازي بـ `[P]` فقط إذا:
  - لا تشترك في تعديل نفس الملف/الوحدة.
  - لا تعتمد على ناتج مهمة لم تُنجز بعد.
- لا تستخدم `[P]` في مهام تهيئة البنية أو الهجرة الحرجة.

صيغة مقترحة لكل مهمة:

```
### T00X: <عنوان المهمة> [P اختياري]
هدف: ...
ملفات: path/to/file.py, ...
يعتمد على: T00Y, (أو: لا شيء)
ناتج: سطر يحدد المخرجات القابلة للتحقق
اختبار: (اختبار/عقد/سيناريو مرتبط أو TODO)
```

(إن كان القالب القياسي مختلفاً في tasks-template.md طبّق هيكله مع دمج الحقول أعلاه نصياً.)

## 6. قواعد التوازي

| حالة | قرار |
|------|------|
| مهام تكتب في نفس الملف | إجبار تسلسل |
| مولد نموذج + خدمة تعتمد عليه | النموذج أولاً |
| اختبار عقد + تنفيذ Endpoint | يمكن اختبار العقد تجهيزياً قبل التنفيذ، لكن التنفيذ غير متوازٍ مع تعديل الملف نفسه |
| مهام تهيئة بيئة (Lint, CI, Virtualenv) | تسلسل مبكر |
| مهام تحسين الأداء المتأخرة | `[P]` غالباً |

## 7. اشتقاق المهام حسب المصدر

| المصدر | مهمة نموذجية | وسم |
|--------|--------------|-----|
| كيان (User) | إنشاء نموذج User + مخطط تخزين | [P] إن مستقل |
| Endpoint /contracts/user/create.json | تنفيذ POST /user/create | تسلسلي إذا يلمس نفس وحدة التجميع |
| ملف عقد | إنشاء اختبار عقد user/create | [P] |
| سيناريو بدء-سريع | اختبار تكامل تشغيل end-to-end | لا |
| متطلب أداء | ضبط إعداد cache أو قياس زمن استجابة | بعد التنفيذ الأساسي |
| مخاطر (Race condition) | معالجة تزامن / قفل | بعد الخدمات المعنية |

## 8. ترتيب نهائي (أولوية التنفيذ)

1. Setup (اعتمادات، بيئة، أدوات، Lint، CI).
2. Models (كيانات البيانات الأساسية).
3. Core / Services (منطق العمل).
4. Contracts / API Implementation.
5. Integration (DB, Logging, Auth, Middlewares).
6. Tests / Coverage Augmentation (قد تتخلل وفق TDD).
7. Non-Functional (Performance, Security, Observability).
8. Polish / Docs / Cleanup.

## 9. توليد الملف

1. حمّل `/templates/tasks-template.md`.
2. استبدل الأمثلة بقائمة فعلية مشتقة.
3. حافظ على الأقسام/العناوين الأساسية (لا تُسقط قسماً إلزامياً؛ ضع TODO إن غير منطبق حالياً).
4. اكتب إلى `FEATURE_DIR/مهام.md` (استبدال كامل).

## 10. التحقق قبل الحفظ

تحقق:
- لا تكرار معرفات.
- لا فجوة اعتماد (كل Depends يشير إلى ID سابق موجود).
- لا توازي خاطئ (تضارب ملفات).
- كل مرحلة فيها ≥ مهمة (أو تبرير TODO).
- لا مهام يتيمة (لا يمكن ربطها بأي مصدر – ضع تعليق: Rationale).

## 11. إخراج موجز خارجي

أخرج (لا يُكتب في الملف):
- إجمالي المهام.
- توزيع حسب المرحلة.
- عدد المهام المتوازية `[P]`.
- تحذيرات (إن وُجدت).
- اقتراح الأمر التالي: غالباً `/تحليل` أو `/تنفيذ`.

## 12. سلوك وحدود

- لا تُنشئ مهام فرعية متداخلة (Flat List).
- لا تُدخل تفاصيل تنفيذ دقيقة (تُرك لاحقاً للمرحلة التنفيذية).
- حافظ على الحتمية (نفس المدخلات → نفس قائمة المهام).
- ممنوع إدخال قرارات معمارية جديدة (يجب أن تُوثَّق في تخطيط.md أولاً).

## 13. حالات فشل

| الحالة | الإجراء |
|--------|---------|
| غياب تخطيط.md | اطلب تشغيل `/تخطيط` أولاً |
| لا مصادر توليد (لا كيانات، لا عقود) | تقليل إلى Setup + TODO(Define scope) |
| تعارض اعتماد دائري | أعد ترتيب أو دمج المهام ووسم تحذير |

---

السياق Context for task generation: {ARGS}

ملاحظة توافق: يمكن استدعاء الأمر باسم `/tasks` بينما اسم الملف عربي `مهام.md`، ويمكن دعم `/مهام` لاحقاً.
