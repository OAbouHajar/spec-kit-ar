---
description: تنفيذ خطة التطوير عبر معالجة كل المهام المعرفة في مهام.md وفق الترتيب والاعتمادات.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks
  ps: scripts/powershell/check-prerequisites.ps1 -Json -RequireTasks -IncludeTasks
---

مدخلات المستخدم (إن وُجدت) يمكن أن تصلك مباشرة من الوكيل أو كوسيط أمر — **يجب** تقييمها قبل البدء.

مدخلات المستخدم:

$ARGUMENTS

الغرض: تنفيذ الميزة استناداً إلى خطة التنفيذ والمهام المعتمدة في `مهام.md` مع احترام الاعتمادات، التوازي المسموح، وضمان التغطية الاختبارية قبل الدمج.

## 1. تهيئة السياق

1. شغّل `{SCRIPT}` من جذر المستودع وحلّل JSON لاستخراج:
   - `FEATURE_DIR`
   - `AVAILABLE_DOCS`
2. اشتق المسارات المطلقة (متوقع توفرها بعد التعريب):
   - TASKS = FEATURE_DIR/مهام.md
   - PLAN = FEATURE_DIR/تخطيط.md
   - SPEC = FEATURE_DIR/مواصفة.md
   - (اختياري عند الوجود): نموذج-البيانات.md، بحث.md، بدء-سريع.md، العقود/
3. إذا غاب `مهام.md`: أوقف التنفيذ واطلب تشغيل `/tasks` أولاً.

## 2. تحميل السياق اللازم

اقرأ بالترتيب:
- (إلزامي) مهام.md: جميع المهام، المراحل، العلامات `[P]` (التوازي)، التسلسل.
- (إلزامي) تخطيط.md: المعمارية، التقنية، البنية المتوقعة، القرارات المفصلية.
- (مهم) مواصفة.md: التتبع المرجعي للمتطلبات.
- (إن وجد) نموذج-البيانات.md: الكيانات، العلاقات، القيود.
- (إن وجد) العقود/: مواصفات واجهات، متطلبات اختبار تكاملي.
- (إن وجد) بحث.md: تبريرات القرارات وأي مخاطر.
- (إن وجد) بدء-سريع.md: سيناريوهات دمج واستخدام.

## 3. تحليل بنية مهام.md

استخرج لكل مهمة:
| حقل | وصف |
|-----|-----|
| ID | معرف فريد (مثل T12) |
| Phase | المرحلة (Setup / Core / Tests / Integration / Polish أو ما هو موجود) |
| Parallel? | علامة `[P]` للتنفيذ المتوازي المسموح |
| Depends | أي تبعيات صريحة أو ضمنية |
| Files | الملفات أو المسارات المشار إليها |
| Description | الهدف التنفيذي |
| Coverage | (لاحقاً) حالات الاختبار المرتبطة |

تحقق:
- لا تداخل غير منطقي في المراحل.
- المهام المتوازية لا تتنافس على نفس الملفات (وإلا تُحوَّل لتسلسلي).

## 4. استراتيجية التنفيذ

التسلسل العام:
1. Setup: تهيئة البنية، الاعتمادات، الأدوات.
2. Tests (استباقي): توليد الهياكل/حالات الأساس (TDD قدر الإمكان).
3. Core: المنطق الأساسي (نماذج، وحدات، خدمات، CLI).
4. Integration: ربط قواعد البيانات، الاتصالات، التسجيل، المراقبة.
5. Polish / Hardening: تحسين الأداء، التوثيق، ضبط المقاييس.

قواعد:
- لا تدخل مرحلة لاحقة قبل اكتمال السابقة (ما لم تُعلن المهمة صراحةً كاستثناء).
- `[P]` يسمح بالتوازي فقط إذا لا تشترك المهام في تعديل نفس الملفات.
- الاختبارات (إن أمكن) تُسبق الكود الذي تتحقق منه.
- إذا أشارت مهمة إلى ملف غير موجود بعد (مخطط إنشائه في مهمة سابقة) انتظر الاعتماد.

## 5. التنفيذ التفصيلي لكل مهمة

لكل مهمة مرتبة:
1. أعِد صياغة الهدف تشغيلياً (داخلي).
2. نفّذ التعديلات (تحرير/إنشاء الملفات).
3. حدّث أو أضِف اختبارات ذات صلة.
4. شغّل الاختبارات السريعة / الجزئية (إن وُجدت بيئة اختبار).
5. تحقق من معايير القبول (عبر المواصفة أو الخطة).
6. علّم المهمة مكتملة بتحديث `مهام.md` (استبدال `[ ]` بـ `[X]` — لا تُغيّر ID).

عند الفشل:
- توقف عن سلسلة المهام غير المتوازية.
- سجّل الخطأ (وصف + ملف + سبب محتمل + اقتراح إصلاح).
- استمر فقط في المهام المتوازية غير المتأثرة (إن منطقياً).

## 6. التوازي Parallel Handling

مجموعة مهام مرحلة بعلامة `[P]`:
- ابنِ مصفوفة تضارب بالملفات (File Conflict Matrix).
- إن وُجد تضارب → أعد ترتيب المتعارض لتسلسل.
- سجّل قرار التحويل (Parallel → Serial) في سجل تقدم داخلي (لا حاجة لكتابة ملف منفصل الآن).

## 7. التتبع والشفافية

بعد كل مهمة مكتملة:
- أبلغ: (ID, Phase, % المرحلة, ملفات معدّلة، اختبارات مضافة/معدّلة).
- حدّث عدّاد: المهام المنجزة / الإجمالي.
- إن تجاوز الفشل المتتابع (N = 2) في نفس المرحلة: اقترح مراجعة المرحلة قبل المتابعة.

## 8. معايير التوقف والاكتمال

اعتبر التنفيذ كاملاً إذا:
- كل المهام الإلزامية معلّمة `[X]`.
- لا تبقى مهام حرجة بلا تنفيذ.
- تتطابق المخرجات (ملفات/مجلدات) مع البنية المتوقعة في تخطيط.md.
- اختبارات حرجة (وحدات + تكامل) مضافة أو محدّثة.
- لا توجد متطلبات وظيفية أساسية بلا تغطية (تتحقق بنظرة إلى مواصفة.md).

## 9. التحقق النهائي Post-Execution Validation

جدول تلخيصي (يُطبع خروجاً):

| Phase | Completed | Total | % | ملاحظات |
|-------|----------:|------:|---:|---------|

قائمة ملفات رئيسية أُنشئت/عُدلت:
```
path/to/file1
path/to/file2
...
```

مصفوفة تغطية سريعة (اختياري):
| Requirement | Covered? | Tasks | Notes |
|-------------|----------|-------|-------|

## 10. الأخطاء والاسترداد

نوعيات الفشل:
- إنشاء ملف
- تعارض مسار
- اختبار يفشل
- تبعية مفقودة
- قرار معماري مفقود (اقترح العودة إلى `/تخطيط`)

أخرج توصيات:
- إعادة تشغيل مهمة محددة
- تعديل أو تقسيم مهمة كبيرة
- الرجوع لمراجعة التخطيط أو المواصفة

## 11. قيود وسلوك

- لا تُضيف مهام جديدة بدون مبرر (إن لزم، اقترح تعديل `/مهام` أولاً).
- لا تحذف مهام؛ إن أصبحت غير ذات صلة علّق (وتحتاج دورة `/مهام` لتحديث بنية الملف).
- حافظ على قابلية التكرار (نفس المدخلات نفس الخرج).
- لا تُعدل الأقسام النصية في `مهام.md` خارج مربعات إنجاز المهام وعلامات التغطية (إن أضيفت).

## 12. الإخراج النهائي

أخرج:
- ملخص اكتمال
- المهام الفاشلة (إن وجدت)
- المهام المتخطاة (مع سبب)
- اقتراح أمر تالٍ (مثل `/تحليل` للتحقق، أو تنفيذ دمج)

ملاحظة توافق: يمكن استدعاء الأمر باسم `/implement` بينما اسم الملف عربي `تنفيذ.md`، ويمكن دعم `/تنفيذ` لاحقاً.

السياق Context: {ARGS}
