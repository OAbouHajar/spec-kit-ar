---
description: "قالب خطة التنفيذ لتطوير الميزة"
scripts:
  sh: scripts/bash/update-agent-context.sh __AGENT__
  ps: scripts/powershell/update-agent-context.ps1 -AgentType __AGENT__
---

# خطة التنفيذ: [FEATURE]

**الفرع**: `[###-feature-name]` | **التاريخ**: [DATE] | **المواصفة**: [link]  
**المدخل**: مواصفة الميزة من المسار `/specs/[###-feature-name]/spec.md`

## تدفق التنفيذ (نطاق أمر /plan)
```
1. تحميل مواصفة الميزة من مسار المدخل
   → إن لم تُوجد: خطأ "لا توجد مواصفة في {path}"
2. تعبئة "السياق التقني" (مسح NEEDS CLARIFICATION)
   → استنتاج نوع المشروع من السياق (ويب = frontend + backend، جوّال = app + api)
   → ضبط قرار الهيكلة بناءً على النوع
3. تعبئة قسم "فحص الدستور" بناءً على ملف الدستور
4. تقييم قسم فحص الدستور
   → إن وُجدت مخالفات: تدوينها في "تتبع التعقيد"
   → إن تعذّر التبرير: خطأ "بسّط النهج أولاً"
   → تحديث "تتبع التقدّم": الفحص الأولي
5. تنفيذ المرحلة 0 → ملف research.md
   → إن بقيت NEEDS CLARIFICATION: خطأ "حل الغموض أولاً"
6. تنفيذ المرحلة 1 → العقود، data-model.md، quickstart.md، ملف الوكيل (agent) الخاص (مثل: `CLAUDE.md` أو `.github/copilot-instructions.md` أو `GEMINI.md` أو `QWEN.md` أو `AGENTS.md`)
7. إعادة فحص قسم الدستور
   → إن ظهرت مخالفات جديدة: إعادة التصميم، والرجوع للمرحلة 1
   → تحديث "تتبع التقدّم": فحص ما بعد التصميم
8. تخطيط المرحلة 2 → وصف نهج توليد المهام (لا تُنشئ tasks.md)
9. توقف - جاهز لأمر /tasks
```

**مهم**: أمر /plan يتوقف عند الخطوة 7. المراحل 2-4 تنفَّذ بأوامر أخرى:
- المرحلة 2: أمر /tasks ينشئ tasks.md
- المرحلة 3-4: تنفيذ (يدوي أو عبر الأدوات)

## الملخص
[مقتطف من المواصفة: المتطلب الرئيسي + النهج التقني من البحث]

## السياق التقني
**اللغة/الإصدار**: [مثال: Python 3.11 أو NEEDS CLARIFICATION]  
**الاعتمادات الأساسية**: [مثل FastAPI أو NEEDS CLARIFICATION]  
**التخزين**: [مثل PostgreSQL أو N/A]  
**الاختبار**: [pytest أو NEEDS CLARIFICATION]  
**المنصة الهدف**: [Linux / iOS / WASM أو NEEDS CLARIFICATION]  
**نوع المشروع**: [single / web / mobile]  
**أهداف الأداء**: [مثل 1000 req/s أو NEEDS CLARIFICATION]  
**القيود**: [مثل <200ms p95 أو NEEDS CLARIFICATION]  
**الحجم/النطاق**: [مثل 10k users أو NEEDS CLARIFICATION]

## فحص الدستور
*بوابة: يجب اجتيازها قبل بحث المرحلة 0. يُعاد الفحص بعد تصميم المرحلة 1.*

[تُولّد البوابات اعتماداً على ملف الدستور]

## هيكل المشروع

### التوثيق (هذه الميزة)
```
specs/[###-feature]/
├── plan.md              # هذا الملف (مخرج /plan)
├── research.md          # مخرج المرحلة 0 (/plan)
├── data-model.md        # مخرج المرحلة 1 (/plan)
├── quickstart.md        # مخرج المرحلة 1 (/plan)
├── contracts/           # مخرج المرحلة 1 (/plan)
└── tasks.md             # مخرج المرحلة 2 (/tasks - لا ينشئه /plan)
```

### الشيفرة (جذر المستودع)
```
# خيار 1: مشروع منفرد (افتراضي)
src/
├── models/
├── services/
├── cli/
└── lib/

tests/
├── contract/
├── integration/
└── unit/

# خيار 2: تطبيق ويب (عند اكتشاف frontend + backend)
backend/
├── src/
│   ├── models/
│   ├── services/
│   └── api/
└── tests/

frontend/
├── src/
│   ├── components/
│   ├── pages/
│   └── services/
└── tests/

# خيار 3: جوّال + API (عند اكتشاف iOS/Android)
api/
└── (مثل backend أعلاه)

ios/ أو android/
└── (بنية خاصة بالمنصة)
```

**قرار البنية**: [الافتراضي خيار 1 ما لم يدل السياق التقني خلاف ذلك]

## المرحلة 0: الخطوط العريضة والبحث
1. استخراج المجهولات من "السياق التقني":
   - كل NEEDS CLARIFICATION → مهمة بحث
   - كل اعتماد → مهمة "أفضل ممارسات"
   - كل تكامل → مهمة "أنماط"
2. توليد مهام البحث:
   ```
   لكل مجهول:
     Task: "بحث {المجهول} في سياق {الميزة}"
   لكل تقنية:
     Task: "أفضل ممارسات {التقنية} في {المجال}"
   ```
3. تجميع النتائج في `research.md` بالتنسيق:
   - القرار
   - المبرر
   - البدائل

**المخرج**: ملف research.md بحل جميع NEEDS CLARIFICATION

## المرحلة 1: التصميم والعقود
*شرط مسبق: اكتمال research.md*

1. استخراج الكيانات → `data-model.md`:
   - الاسم، الحقول، العلاقات
   - قواعد التحقق
2. توليد عقود API من المتطلبات:
   - كل فعل مستخدم → مسار endpoint
   - استخدام REST/GraphQL قياسي
   - إخراج مخطط OpenAPI/GraphQL إلى `/contracts/`
3. توليد اختبارات العقود:
   - ملف اختبار لكل endpoint
   - تأكيد مخططات الطلب/الرد
   - يجب أن تفشل (لا تنفيذ بعد)
4. استخراج سيناريوهات الاختبار من القصص:
   - كل قصة → اختبار تكامل
   - quickstart = خطوات تحقق القصة
5. تحديث ملف الوكيل تدريجياً:
   - تشغيل `{SCRIPT}`
   - إضافة التقنية الجديدة فقط
   - الحفاظ على الإضافات اليدوية
   - آخر 3 تغييرات
   - أقل من 150 سطر

**المخرج**: data-model.md، محتوى /contracts، اختبارات فاشلة، quickstart.md، ملف الوكيل

## المرحلة 2: نهج تخطيط المهام
*وصف لما سيفعله أمر /tasks - لا يُنفّذ في /plan*

**استراتيجية التوليد**:
- تحميل `.specify/templates/tasks-template.md`
- من التصميم (العقود + نموذج البيانات + quickstart)
- كل عقد → مهمة اختبار عقد [P]
- كل كيان → مهمة نموذج [P]
- كل قصة → اختبار تكامل
- مهام تنفيذ لجعل الاختبارات تمر

**الترتيب**:
- TDD: الاختبارات أولاً
- تبعية: النماذج → الخدمات → الواجهات
- [P] للمهام المستقلة

**المخرج المتوقع**: 25-30 مهمة مرقمة في tasks.md

**مهم**: هذه المرحلة لأمر /tasks فقط

## المرحلة 3+: ما بعد /plan
- المرحلة 3: توليد المهام (/tasks)
- المرحلة 4: التنفيذ
- المرحلة 5: التحقق (تشغيل الاختبارات، تنفيذ quickstart، قياس الأداء)

## تتبع التعقيد
*املأ فقط عند وجود مخالفات دستورية مبررة*

| المخالفة | لماذا مطلوبة | البديل الأبسط ولماذا رُفض |
|----------|--------------|---------------------------|
| مثال | الحاجة الحالية | سبب عدم كفاية الأبسط |

## تتبع التقدّم
*تُحدّث أثناء التدفق*

**حالة المراحل**:
- [ ] المرحلة 0: بحث مكتمل (/plan)
- [ ] المرحلة 1: تصميم مكتمل (/plan)
- [ ] المرحلة 2: تخطيط مهام مكتمل (/plan - وصف فقط)
- [ ] المرحلة 3: المهام مولدة (/tasks)
- [ ] المرحلة 4: تنفيذ مكتمل
- [ ] المرحلة 5: تحقق ناجح

**حالة البوابات**:
- [ ] فحص الدستور الأول: PASS
- [ ] فحص ما بعد التصميم: PASS
- [ ] حل جميع NEEDS CLARIFICATION
- [ ] توثيق الانحرافات التعقيدية

---
*استناداً إلى الدستور v2.1.1 - راجع `/memory/constitution.md`*
