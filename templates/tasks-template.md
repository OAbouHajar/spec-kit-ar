# المهام: [FEATURE NAME]

**المدخل**: مستندات التصميم من المسار `/specs/[###-feature-name]/`  
**المتطلبات**: `plan.md` (إلزامي)، و `research.md`، و `data-model.md`، ومجلد `contracts/`

## تدفق التنفيذ (main)
```
1. تحميل plan.md من مجلد الميزة
   → إن لم يوجد: خطأ "لا توجد خطة تنفيذ"
   → استخراج: التقنية، المكتبات، البنية
2. تحميل مستندات التصميم الاختيارية:
   → data-model.md: استخراج الكيانات → مهام النمذجة
   → contracts/: كل ملف → مهمة اختبار عقد
   → research.md: استخراج القرارات → مهام الإعداد
3. توليد المهام حسب الفئة:
   → Setup: التهيئة، الاعتمادات، الفحص (lint)
   → Tests: اختبارات العقود، اختبارات التكامل
   → Core: النماذج، الخدمات، أوامر CLI
   → Integration: قاعدة البيانات، الطبقة الوسطى، التسجيل
   → Polish: اختبارات وحدات، أداء، توثيق
4. تطبيق قواعد المهام:
   → ملفات مختلفة = وسم [P] (تنفيذ متوازٍ)
   → نفس الملف = تسلسل (بدون [P])
   → الاختبارات قبل التنفيذ (TDD)
5. ترقيم المهام (T001, T002…)
6. توليد مخطط التبعيات
7. إنشاء أمثلة للتنفيذ المتوازي
8. التحقق من اكتمال التغطية:
   → هل لكل عقد اختبار؟
   → هل لكل كيان نموذج؟
   → هل كل Endpoint منفّذ؟
9. إرجاع: SUCCESS (المهام جاهزة للتنفيذ)
```

## الصيغة: `[ID] [P?] الوصف`
- **[P]**: يمكن تنفيذ المهمة بالتوازي (ملف مستقل، لا تبعية)
- يجب تضمين المسار الدقيق للملف

## اصطلاحات المسارات
- **مشروع منفرد**: `src/` و `tests/` في الجذر
- **تطبيق ويب**: `backend/src/` و `frontend/src/`
- **تطبيق جوّال**: `api/src/` و `ios/src/` أو `android/src/`
- الأمثلة أدناه تفترض مشروعاً منفرداً (عدّل حسب خطة التنفيذ)

## المرحلة 3.1: الإعداد (Setup)
- [ ] T001 إنشاء هيكل المشروع وفق خطة التنفيذ
- [ ] T002 تهيئة مشروع [اللغة] مع اعتمادات [الإطار]
- [ ] T003 [P] إعداد أدوات الفحص والتنسيق (Lint/Format)

## المرحلة 3.2: الاختبارات أولاً (TDD) ⚠️ يجب إكمالها قبل 3.3
**هام: يجب كتابة هذه الاختبارات وأن تفشل قبل أي تنفيذ**
- [ ] T004 [P] اختبار عقد POST /api/users في tests/contract/test_users_post.py
- [ ] T005 [P] اختبار عقد GET /api/users/{id} في tests/contract/test_users_get.py
- [ ] T006 [P] اختبار تكامل تسجيل المستخدم في tests/integration/test_registration.py
- [ ] T007 [P] اختبار تكامل سير المصادقة في tests/integration/test_auth.py

## المرحلة 3.3: التنفيذ الأساسي (بعد فشل الاختبارات)
- [ ] T008 [P] نموذج User في src/models/user.py
- [ ] T009 [P] خدمة UserService (عمليات CRUD) في src/services/user_service.py
- [ ] T010 [P] أمر CLI --create-user في src/cli/user_commands.py
- [ ] T011 تنفيذ Endpoint ‏POST /api/users
- [ ] T012 تنفيذ Endpoint ‏GET /api/users/{id}
- [ ] T013 التحقق من المدخلات (Input Validation)
- [ ] T014 معالجة الأخطاء والتسجيل (Logging)

## المرحلة 3.4: التكامل
- [ ] T015 ربط UserService بقاعدة البيانات
- [ ] T016 وسيط المصادقة (Auth Middleware)
- [ ] T017 تسجيل الطلب/الاستجابة
- [ ] T018 تفعيل CORS وترويسات الأمان

## المرحلة 3.5: التلميع (Polish)
- [ ] T019 [P] اختبارات وحدات للتحقق في tests/unit/test_validation.py
- [ ] T020 اختبارات الأداء (<200ms)
- [ ] T021 [P] تحديث التوثيق في docs/api.md
- [ ] T022 إزالة التكرار
- [ ] T023 تنفيذ manual-testing.md

## التبعيات
- الاختبارات (T004–T007) قبل التنفيذ (T008–T014)
- T008 تحجب T009 و T015
- T016 تحجب T018
- التنفيذ قبل التلميع (T019–T023)

## مثال تنفيذ متوازٍ
```
# إطلاق T004-T007 معاً:
Task: "اختبار عقد POST /api/users في tests/contract/test_users_post.py"
Task: "اختبار عقد GET /api/users/{id} في tests/contract/test_users_get.py"
Task: "اختبار تكامل التسجيل في tests/integration/test_registration.py"
Task: "اختبار تكامل المصادقة في tests/integration/test_auth.py"
```

## ملاحظات
- المهام ذات [P] = ملفات مستقلة بلا تعارض
- تأكد أن الاختبارات تفشل قبل التنفيذ
- نفّذ التزام (commit) بعد كل مهمة
- تجنّب: مهام غامضة، تضارب نفس الملف في مهام متوازية

## قواعد توليد المهام
*تُطبق أثناء التنفيذ*

1. **من العقود**:
   - كل ملف عقد → مهمة اختبار عقد [P]
   - كل Endpoint → مهمة تنفيذ
2. **من نموذج البيانات**:
   - كل كيان → مهمة نموذج [P]
   - العلاقات → مهام طبقة الخدمة
3. **من قصص المستخدم**:
   - كل قصة → اختبار تكامل [P]
   - quickstart → مهام تحقق
4. **الترتيب**:
   - إعداد → اختبارات → نماذج → خدمات → Endpoints → تلميع
   - التبعيات تمنع الوسم [P]

## قائمة التحقق (Validation)
*بوابة: تُفحص قبل الإرجاع*
- [ ] لكل عقد اختبار
- [ ] لكل كيان مهمة نموذج
- [ ] جميع الاختبارات تسبق التنفيذ
- [ ] المهام المتوازية مستقلة فعلاً
- [ ] كل مهمة تحدد مسار ملف دقيق
- [ ] لا توجد مهمة [P] تعدل نفس الملف مع أخرى
